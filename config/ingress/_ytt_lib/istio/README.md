## Istio configuration

This ytt library contains templates and overlays to set up Istio in CF for K8s.

### Structure

**manifest.star**

This file contains an array of always-applied overlays, and a dictionary of
conditionally applied overlays. These are consumed and used by
[ingress_solution.yml](../../ingress_solution.yml).

**values.yaml**

These are the values that the overlays below depend on. They define a contract
between the library and its user (cf-for-k8s in this case) for what values must 
be provided for the library to function.

**istio-generated/**

This folder contains the template generated by istioctl. Do not modify its
contents.

**overlays/**

These are overlays. They must be contained in a function, loaded by
[manifest.star](manifest.star), and called appropriately.

**templates/**

These are templates which are always included. They can include ytt logic like
functions, variables, etc, but must not include the `overlay` directive.

### Adding a data value

If your overlay requires a value from data.values, you gotta do some work:

1. Write your overlay, it might be easier to iterate if you initially write it
   outside the library
1. Move your overlay into `overlays/`
1. Include it in [manifest.star](./manifest.star)
  * If it's included conditionally, update [ingress_solution.yml](../../ingress_solution.yml) appropriately
1. Add any new data values you require to [values.yaml](./values.yaml)
1. Add any new data values you require to [ingress_solution.yml](../../ingress_solution.yml)
1. Update this readme with anything you learned

